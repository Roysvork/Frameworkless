<html>
	<head>
		<title>Lifestyles of the rich and Frameworkless - Templating Demo</title>
	</head>
	<body>

		<h2>Frameworkless Todo List</h2>
		<ul id="list">			
		</ul>
		<input type="button" id="addButton" value="add" />

		<template id="list-item">
			<li>
				<input type="checkbox" name="done" />
				<label for="done"><a>Testing</a></label>
				<fieldset class="editor hidden">
					<legend>Edit</legend>
					<span>
						<label for="summary">Summary</label>
						<input type="text" name="summary"/>
					</span>					
					<input type="button" name="removeBtn" value="Remove"/>
				</fieldset>
			</li>
		</template>

		<script type="text/javascript" src="lib/common.js"></script>
		<script type="text/javascript" src="lib/navigation.js"></script>
		<script type="text/javascript" src="lib/routing.js"></script>
		<script type="text/javascript" src="lib/data-binding.js"></script>
		<script type="text/javascript" src="lib/dependency-injection.js"></script>
		<script type="text/javascript" src="lib/templating.js"></script>

		<script type="text/javascript" src="lib/repository.js"></script>
		<script type="text/javascript">

		var viewModel = dependency.inject(['repository'], function(repository) {
			this.getItems = function () {
				return repository.getAll()
			};

			this.addClick = function () {
				var newItem = {
					editing: true,
					summary: "New item",
					done: false
				}

				repository.add(newItem);
				this.getItems.update();
			}.bind(this);

			this.removeClick = function (item) {
				repository.remove(item);
				this.getItems.update();
			}
		});

		ready(function() {			
			var model = new viewModel();

			click("#addButton", model.addClick);

			var listItem = templating.repeat("#list-item", function(item, content) {
				dataBinding.clear(item, "done");

				dataBinding.to.text(item, "summary", "label", content);
				dataBinding.to.showHide(item, "editing", "fieldset", content);
				
				var textSelector = "fieldset > span > input[type=text]";
				dataBinding.to.value(item, "summary", textSelector, content);
				dataBinding.from.value(item, "summary", textSelector, content);
				
				dataBinding.to.checked(item, "done", "input", content);
				dataBinding.to.strikeThrough(item, "done", "label", content);
				dataBinding.from.checked(item, "done", "input", content);

				click("fieldset > input", function () {
					model.removeClick(item);
				}, content);

				click("label", function() {
					item.editing = !item.editing;
				}, content);
			});

			dataBinding.observe(model, "getItems", function (newValue) {
				listItem.render(newValue).to("#list");				
			});
		
		});

		</script>

		<style>
			.hidden {
				display: none;	
			}
			li > label {
				cursor: pointer;
			}
		</style>

	</body>
</html>